services:
  mlflow:
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    expose:
      - "5000"
    volumes:
      - mlflow-data:/data
    environment:
      # Coolify magic variables - generates URL and routes traffic to port 5000
      - SERVICE_URL_MLFLOW_5000
      - SERVICE_FQDN_MLFLOW
      - SERVICE_PASSWORD_MLFLOW
      # Use generated password for both
      - MLFLOW_FLASK_SERVER_SECRET_KEY=${SERVICE_PASSWORD_MLFLOW}
      - MLFLOW_ADMIN_PASSWORD=${SERVICE_PASSWORD_MLFLOW}
    command: >
      mlflow server
      --host 0.0.0.0
      --port 5000
      --backend-store-uri sqlite:///data/mlflow.db
      --default-artifact-root mlflow-artifacts:/
      --artifacts-destination /data/artifacts
      --serve-artifacts
      --allowed-hosts '*'
      --app-name basic-auth

volumes:
  mlflow-data:
